{"version":3,"file":"stream.js","sources":["../stream.js"],"sourcesContent":["const EventEmitter = require('events');\nconst END = '\\r\\n';\nconst END_LENGTH = 2;\n\nclass Stream extends EventEmitter {\n  constructor() {\n    super();\n    this.buffer = '';\n  }\n\n  parse(buffer) {\n    this.buffer += buffer.toString('utf8');\n    let index;\n    let json;\n\n    while ((index = this.buffer.indexOf(END)) > -1) {\n      json = this.buffer.slice(0, index);\n      this.buffer = this.buffer.slice(index + END_LENGTH);\n      if (json.length > 0) {\n        try {\n          json = JSON.parse(json);\n          this.emit(json.event || 'data', json);\n        } catch (error) {\n          error.source = json;\n          this.emit('error', error);\n        }\n      } else {\n        this.emit('ping');\n      }\n    }\n  }\n}\n\nmodule.exports = Stream;\n"],"names":["const","EventEmitter","require","module","exports","constructor","buffer","parse","index","json","toString","this","indexOf","slice","length","JSON","emit","event","error","source"],"mappings":"AAAAA,IAAMC,EAAeC,QAAQ,UAiC7BC,OAAOC,oBA5BLC,+BAEOC,OAAS,mGAGhBC,eAAMD,OAEAE,EACAC,WAFCH,QAAUA,EAAOI,SAAS,SAIvBF,EAAQG,KAAKL,OAAOM,QAdpB,UAcqC,MAC3CH,EAAOE,KAAKL,OAAOO,MAAM,EAAGL,QACvBF,OAASK,KAAKL,OAAOO,MAAML,EAfnB,GAgBTC,EAAKK,OAAS,MAEdL,EAAOM,KAAKR,MAAME,QACbO,KAAKP,EAAKQ,OAAS,OAAQR,GAChC,MAAOS,GACPA,EAAMC,OAASV,OACVO,KAAK,QAASE,aAGhBF,KAAK,YAvBGf"}